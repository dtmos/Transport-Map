<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>OpenLayers Export Map Example</title>
        <link rel="stylesheet" href="../theme/default/style.css" type="text/css" />
        <link rel="stylesheet" href="style.css" type="text/css" />
        <script src="../lib/OpenLayers.js"></script>
        
        <script type="text/javascript">
            var map;
            var exportMapControl;
        
            function init(){
                map = new OpenLayers.Map('map');
                
                var wmsBase = new OpenLayers.Layer.WMS("OpenLayers WMS", 
                    "http://labs.metacarta.com/wms/vmap0?", 
//                    "proxy.cgi?url=http://labs.metacarta.com/wms/vmap0?",
                    {
                        layers: 'basic'
                    }, 
                    {
                        useCanvas: OpenLayers.Layer.Grid.ONECANVASPERLAYER
                    });
                
                var wmsOverlay = new OpenLayers.Layer.WMS("FAO GeoNetwork: Suitability of currently available land for rainfed production of oil crops", 
                    "http://geonetwork3.fao.org/ows/14097?",
//                    "proxy.cgi?url=http://geonetwork3.fao.org/ows/14097?", 
                    {
                        layers: "currently_oil_crops_intermediate_level_inputs",
                        transparent: true
                    }, 
                    {
                        useCanvas: OpenLayers.Layer.Grid.ONECANVASPERLAYER,
                        isBaseLayer: false
                    });
                
                var vector = new OpenLayers.Layer.Vector("GML", {
                    strategies: [new OpenLayers.Strategy.Fixed()],
                    protocol: new OpenLayers.Protocol.HTTP({
                        url: "gml/polygon.xml",
                        format: new OpenLayers.Format.GML()
                    }),
                    styleMap: new OpenLayers.StyleMap({
                        "default": new OpenLayers.Style({
                            fillColor: "#ffffff",
                            strokeColor: "#000000",
                            strokeWidth: 2
                        })
                    }),
                    renderers: ["Canvas", "SVG", "VML"]
                });
                
                map.addLayers([wmsBase, wmsOverlay, vector]);
                
                exportMapControl = new OpenLayers.Control.ExportMap();
                map.addControl(exportMapControl);
                map.addControl(new OpenLayers.Control.LayerSwitcher());
                
                map.zoomToExtent(new OpenLayers.Bounds(-11.8296875, 39.54021484375, 10.6703125, 50.79021484375));
            }
            
            function exportMap() {
                var canvas = OpenLayers.Util.getElement("exportedImage");
                exportMapControl.trigger(canvas);   
                
//                // set download url (toDataURL() requires the use of a proxy)
//                OpenLayers.Util.getElement("downloadLink").href = canvas.toDataURL();
            }
            
       
        </script>
    </head>
    <body onload="init()">
        <h1 id="title">Export Map</h1>
        <p id="shortdesc">
            Export map as image file.
        </p>
        <div id="map" class="smallmap"></div>
        
        <div>
            <input type="button" value="Export Map" onClick="exportMap()" /> <br />
            <p>Exported map:</p>
            <canvas id="exportedImage" class="smallmap"></canvas> <br />
            <!-- <a id="downloadLink" href="#" target="_blank">Download Image</a> (-> Save Link as) -->
        </div>
        
        <div id="docs">
            Click on <b>Export Map</b> to render all canvas layers on a single 
            canvas. Firefox users can download the exported image with <b>Rightclick ->
            Save Image As</b>. On other browsers a download URL can be generated with
            <b>Canvas.toDataURL()</b>, but then all images must be requested through a
            proxy.
        </div>
    </body>
</html>
